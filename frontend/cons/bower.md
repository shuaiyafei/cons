### 浏览器

- [渲染原理](#render)
- [存储](#storage)
- [跨域](#cross)
- [缓存](#cache)
- [性能](#chacter)
- [优化](#optimize)

#### <t id="render" />渲染原理

**渲染过程**

- 解析`HTML`，生成`DOM tree`。
- 解析`CSS`， 生成`CSSOM tree`。
- `DOM tree` 和 `CSSOM tree` 合并生成 `render tree`。
- 此时可以计算出各节点的位置以及尺寸。
- 回执页面的像素信息。
- 浏览器将各层的信息发送到`GPU`，`GPU`将各层合成，显示到屏幕上。

**构建DOM树**

当浏览器接收到服务器响应来的`HTML`文档后，会遍历文档节点，生成DOM树。

> DOM树的生成过程中可能会被解析CSS和JS造成阻塞。

**构建CSSOM树**

浏览器在解析CSS文件并生成CSS规则树，CSS规则树中包括了对象的类型和属性。

**渲染阻塞**

当浏览器遇到一个script标记时，DOM构建将暂停，直到该脚本执行完成，然后继续构建DOM。每次去执行JavaScript脚本都会严重的阻塞DOM树的构建。如果JavaScript脚本还操作了CSSOM，而正好这个CSSOM还没有下载和构建，浏览器甚至会延迟脚本执行和构建DOM，直至完成其CSSOM的下载和构建。

> 使用遵循两个原则。

> CSS应该放入页面的顶部。

> JS置于页面的底部。

**构建渲染树**

通过DOM树和CSS规则树我们便可以构建渲染树。浏览器会先从DOM树的根节点开始遍历每个可见节点。对每个可见节点，找到其适配的CSS样式规则并应用。

渲染树构建完成后，每个节点都是可见节点并且都含有其内容和对应规则的样式。这也是渲染树与DOM树的最大区别所在。渲染树是用于显示，那些不可见的元素当然就不会在这棵树中出现了，譬如。除此之外，display等于none的也不会被显示在这棵树里头，但是visibility等于hidden的元素是会显示在这棵树里头的。

**渲染树布局**

布局阶段会从渲染树的根节点开始遍历，然后确定每个节点对象在页面上的确切大小与位置，布局阶段的输出是一个盒子模型，它会精确地捕获每个元素在屏幕内的确切位置与大小。

**渲染树绘制**

在绘制阶段，遍历渲染树，调用渲染器的paint()方法在屏幕上显示其内容。渲染树的绘制工作是由浏览器的UI后端组件完成的。

**回流和重绘**

根据渲染树布局，计算CSS样式，即每个节点在页面中的大小和位置等几何信息。HTML默认是流式布局的，CSS和js会打破这种布局，改变DOM的外观样式以及大小和位置。

> 重绘是当节点需要更改外观而不会影响布局的，比如改变 color 就叫称为重绘

> 回流是布局或者几何属性需要改变就称为回流。

回流一定发生了重绘，重绘不一定会回流。回流所需的成本比重绘高，实际操作的过程中，改变某个节点可能会导致一系列的回流。

哪些操作会触发回流。

- 改变 window 大小
- 改变字体
- 添加或删除样式
- 文字改变
- 定位或者浮动
- 盒模型

> 重绘和回流其实和 Event loop 有关。

> 提高性能主要是要减少重绘和回流。

#### 存储<t id="storage" />

> 记录用户的状态，存储在客户端中。

- Cookie
- Web存储
- IndexedDB

**Cookie**

Cookie又称http Cookie，最初是在客户端用于存储会话信息，从底层来看，Cookie数据会在浏览器和服务器之间传输，因此Cookie通常用于存储一些通用的数据，比如用户的登陆状态，首选项等。

Cookie的优点。

首先由于操作Cookie的API很早就已经定义和实现了，因此相比于其他的数据存储方式，Cookie的兼容性非常的好，兼容现在市面上所有的主流浏览器，我们在使用它的时候完全不用担心兼容问题。

Cookie的缺点。

- 存储量小。虽不同浏览器的存储量不同，但基本上都是在4kb左右。
- 影响性能。由于Cookie会由浏览器作为请求头发送，因此当Cookie存储信息过多时，会影响特定域的资源获取的效率，增加文档传输的负载。
- 只能储存字符串。
- 安全问题。存储在Cookie的任何数据可以被他人访问，因此不能在Cookie中储存重要的信息。

**Cookie的操作**

基本的Cookie操作主要有三个：读取，写入和删除。


#### 跨域<t id="cross" />

#### 缓存<t id="cache" />

#### 性能<t id="chacter" />

#### 优化<t id="optimize" />


